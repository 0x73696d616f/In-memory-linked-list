<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Foundry Template</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="src/InMemoryStack.sol/struct.Entry.html">Entry</a></li><li class="chapter-item "><a href="src/InMemoryStack.sol/struct.Stack.html">Stack</a></li><li class="chapter-item "><a href="src/InMemoryStack.sol/contract.InMemoryStack.html">InMemoryStack</a></li><li class="chapter-item "><a href="src/InMemoryStack.sol/function.buildEntryPointer.html">buildEntryPointer</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Foundry Template</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/0x73696d616f/In-memory-stack" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="in-memory-dynamic-stack"><a class="header" href="#in-memory-dynamic-stack">In memory dynamic stack <a href="https://github.com/threesigmaxyz/foundry-template/actions"><img src="https://github.com/threesigmaxyz/foundry-template/actions/workflows/ci.yml/badge.svg" alt="Github Actions" /></a> <a href="https://getfoundry.sh/"><img src="https://img.shields.io/badge/Built%20with-Foundry-FFDB1C.svg" alt="Foundry" /></a> <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License: MIT" /></a></a></h1>
<p>A dynamic memory stack implementation in solidity.</p>
<h2 id="blueprint"><a class="header" href="#blueprint">Blueprint</a></h2>
<pre><code class="language-ml">lib
├─ forge-std — https://github.com/foundry-rs/forge-std
├─ openzeppelin-contracts — https://github.com/OpenZeppelin/openzeppelin-contracts
scripts
├─ 01_Deploy.s.sol — Simple Deployment Script
src
├─ InMemoryStack.sol — The library
test
└─ InMemoryStack.t.sol — Tests
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Here's a list of the most frequently needed commands.</p>
<h3 id="build"><a class="header" href="#build">Build</a></h3>
<p>Build the contracts:</p>
<pre><code class="language-sh">$ make build
</code></pre>
<h3 id="clean"><a class="header" href="#clean">Clean</a></h3>
<p>Delete the build artifacts and cache directories:</p>
<pre><code class="language-sh">$ make clean
</code></pre>
<h3 id="compile"><a class="header" href="#compile">Compile</a></h3>
<p>Compile the contracts:</p>
<pre><code class="language-sh">$ make build
</code></pre>
<h3 id="test"><a class="header" href="#test">Test</a></h3>
<p>To run all tests execute the following commad:</p>
<pre><code>make tests
</code></pre>
<p>Alternatively, you can run specific tests as detailed in this <a href="https://book.getfoundry.sh/forge/tests">guide</a>.</p>
<h2 id="benchmarking"><a class="header" href="#benchmarking">Benchmarking</a></h2>
<p>In the test <code>testBenchmarkDynamicVsStatic()</code> the gas costs of the dynamic stack vs a fixed sized array are compared.</p>
<p>The gas cost is approximately the same when 1000 elements are declared in the static array, but only 100 elements are effectively added.</p>
<p>Thus, try to use static arrays whenever possible to reduce gas overload.</p>
<h1 id="about-us"><a class="header" href="#about-us">About Us</a></h1>
<p><a href="https://threesigma.xyz/">Three Sigma</a> is a venture builder firm focused on blockchain engineering, research, and investment. Our mission is to advance the adoption of blockchain technology and contribute towards the healthy development of the Web3 space.</p>
<p>If you are interested in joining our team, please contact us <a href="mailto:info@threesigma.xyz">here</a>.</p>
<hr />
<p align="center">
  <img src="https://threesigma.xyz/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fthree-sigma-labs-research-capital-white.0f8e8f50.png&w=2048&q=75" width="75%" />
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="entry"><a class="header" href="#entry">Entry</a></h1>
<p><a href="https://github.com/0x73696d616f/In-memory-stack/blob/d3dfeefea5dc2ac82a6234c769d8f21c15a84faf/src/InMemoryStack.sol">Git Source</a></p>
<p><strong>Author:</strong>
@0x73696d616f</p>
<p>A library for managing dynamic in-memory stack of bytes. This can hold any basic type or struct. Due to lack of
generics in Solidity, this library uses a workaround to manage dynamic arrays of different types. Under the hood it
is storing an arbitrary amount of bytes so in order to store a struct, it has to be encoded before storing (using abi.encode)
and decoded after it is retreived from the stack (using abi.decode). This library is meant to be used with the stack
struct.</p>
<p>Entry is an element stored inside the stack. Value is stored as bytes so it can be any basic
type or struct, it just has to be encoded before storing and decoded after retreived from the stack.
Entry also contains references the next entry in the stack. Entry[] funcitons as a pointer,
if it's empty stack, it's null. If it has one element, it's the pointer to the next entry.</p>
<p><em>Under the hood it implements a linked list data structure.</em></p>
<pre><code class="language-solidity">struct Entry {
    bytes value;
    Entry[] next;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stack"><a class="header" href="#stack">Stack</a></h1>
<p><a href="https://github.com/0x73696d616f/In-memory-stack/blob/d3dfeefea5dc2ac82a6234c769d8f21c15a84faf/src/InMemoryStack.sol">Git Source</a></p>
<p>Stack is a dynamic stack of Entries. It contains the length of the stack and a pointer to the
first entry of the stack. If the stack is empty, firstEntry is an empty array.</p>
<pre><code class="language-solidity">struct Stack {
    uint256 length;
    Entry[] firstEntry;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inmemorystack"><a class="header" href="#inmemorystack">InMemoryStack</a></h1>
<p><a href="https://github.com/0x73696d616f/In-memory-stack/blob/d3dfeefea5dc2ac82a6234c769d8f21c15a84faf/src/InMemoryStack.sol">Git Source</a></p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="createemptystack"><a class="header" href="#createemptystack">createEmptyStack</a></h3>
<p>Creates an empty Stack</p>
<pre><code class="language-solidity">function createEmptyStack() internal pure returns (Stack memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>Stack</code></td><td>Stack The empty Stack</td></tr>
</tbody></table>
</div>
<h3 id="push"><a class="header" href="#push">push</a></h3>
<p>Pushes a new value to the top of the stack</p>
<pre><code class="language-solidity">function push(Stack memory stack_, bytes memory value_) internal pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>stack_</code></td><td><code>Stack</code></td><td>The stack to push the value to</td></tr>
<tr><td><code>value_</code></td><td><code>bytes</code></td><td>The value to push to the stack</td></tr>
</tbody></table>
</div>
<h3 id="pop"><a class="header" href="#pop">pop</a></h3>
<p>Removes the firsr value from the stack. Reverts when there is no element to remove.</p>
<pre><code class="language-solidity">function pop(Stack memory stack_) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>stack_</code></td><td><code>Stack</code></td><td>The stack to pop the value from</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>value The value popped from the stack</td></tr>
</tbody></table>
</div>
<h3 id="getentry"><a class="header" href="#getentry">getEntry</a></h3>
<p>Retreives the entry at the specified index without removing it</p>
<pre><code class="language-solidity">function getEntry(Stack memory stack_, uint256 index_) internal pure returns (Entry memory entry_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>stack_</code></td><td><code>Stack</code></td><td>The stack to retreive the entry from</td></tr>
<tr><td><code>index_</code></td><td><code>uint256</code></td><td>The index of the entry to retreive</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>entry_</code></td><td><code>Entry</code></td><td>The entry at the specified index</td></tr>
</tbody></table>
</div>
<h3 id="set"><a class="header" href="#set">set</a></h3>
<p>Sets the value at the specified index</p>
<pre><code class="language-solidity">function set(Stack memory stack_, uint256 index_, bytes memory value_) internal pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>stack_</code></td><td><code>Stack</code></td><td>The stack to set the value in</td></tr>
<tr><td><code>index_</code></td><td><code>uint256</code></td><td>The index of the value to set</td></tr>
<tr><td><code>value_</code></td><td><code>bytes</code></td><td>The value to set</td></tr>
</tbody></table>
</div>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="emptystackerror"><a class="header" href="#emptystackerror">EmptyStackError</a></h3>
<pre><code class="language-solidity">error EmptyStackError();
</code></pre>
<h3 id="indexoutofboundserror"><a class="header" href="#indexoutofboundserror">IndexOutOfBoundsError</a></h3>
<pre><code class="language-solidity">error IndexOutOfBoundsError();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="buildentrypointer"><a class="header" href="#buildentrypointer">buildEntryPointer</a></h1>
<p><a href="https://github.com/0x73696d616f/In-memory-stack/blob/d3dfeefea5dc2ac82a6234c769d8f21c15a84faf/src/InMemoryStack.sol">Git Source</a></p>
<p>This is a helper function to build a &quot;pointer&quot; to an entry.
Technically, it is not a pointer but it functions as one.
It's used to set the next entry.</p>
<pre><code class="language-solidity">function buildEntryPointer(Entry memory entry_) pure returns (Entry[] memory entryPointer_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>entry_</code></td><td><code>Entry</code></td><td>The entry to build a pointer to</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>entryPointer_</code></td><td><code>Entry[]</code></td><td>The pointer to the entry passed as a parameter</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
